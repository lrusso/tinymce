!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.util.VK"),n=function(e){return!1},o=function(e){return e.rel_list},i=function(e){return e.link_class_list},r=function(e){return"boolean"==typeof e.link_assume_external_targets&&e.link_assume_external_targets},a=function(e){return"boolean"==typeof e.link_context_toolbar&&e.link_context_toolbar},l=function(e){return e.link_list},u=n,c=function(e,t){e.settings.target_list=t},s=function(e){return!1},f=o,d=function(e){return void 0!==o(e)},v=i,m=function(e){return void 0!==i(e)},h=function(e){return!1},g=function(e){return"boolean"==typeof e.allow_unsafe_link_target&&e.allow_unsafe_link_target},x=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),p=tinymce.util.Tools.resolve("tinymce.Env"),k=function(e){if(!p.ie||p.ie>10){var t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r=t,a=n,document.body.appendChild(r),r.dispatchEvent(a),document.body.removeChild(r)}else{var o=window.open("","_blank");if(o){o.opener=null;var i=o.document;i.open(),i.write('<meta http-equiv="refresh" content="0; url='+x.DOM.encode(e)+'">'),i.close()}}var r,a},y=tinymce.util.Tools.resolve("tinymce.util.Tools"),b=function(e,t){var n,o,i=["noopener"],r=e?e.split(/\s+/):[],a=function(e){return e.filter(function(e){return-1===y.inArray(i,e)})};return(r=t?(n=a(n=r)).length?n.concat(i):i:a(r)).length?(o=r,y.trim(o.sort().join(" "))):null},w=function(e,t){return t=t||e.selection.getNode(),T(t)?e.dom.select("a[href]",t)[0]:e.dom.getParent(t,"a[href]")},_=function(e){return e&&"A"===e.nodeName&&e.href},T=function(e){return e&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className)},C=function(e,t){var n,o;(o=e.dom.select("img",t)[0])&&(n=e.dom.getParents(o,"a[href]",t)[0])&&(n.parentNode.insertBefore(o,n),e.dom.remove(n))},M=function(e,t,n){var o,i;(i=e.dom.select("img",t)[0])&&(o=e.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))},O=function(e,t){return function(n){e.undoManager.transact(function(){var o=e.selection.getNode(),i=w(e,o),r={href:n.href,target:n.target?n.target:null,rel:n.rel?n.rel:null,class:n.class?n.class:null,title:n.title?n.title:null};d(e.settings)||!1!==g(e.settings)||(r.rel=b(r.rel,"_blank"===r.target)),n.href===t.href&&(t.attach(),t={}),i?(e.focus(),n.hasOwnProperty("text")&&("innerText"in i?i.innerText=n.text:i.textContent=n.text),e.dom.setAttribs(i,r),e.selection.select(i),e.undoManager.add()):T(o)?M(e,o,r):n.hasOwnProperty("text")?e.insertContent(e.dom.createHTML("a",r,e.dom.encode(n.text))):e.execCommand("mceInsertLink",!1,r)})}},R=function(e){return function(){e.undoManager.transact(function(){var t=e.selection.getNode();T(t)?C(e,t):e.execCommand("unlink")})}},N=_,A=function(e){return y.grep(e,_).length>0},L=function(e){return!(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1===e.indexOf("href=")))},P=w,E=function(e,t){var n=t?t.innerText||t.textContent:e.getContent({format:"text"});return n.replace(/\uFEFF/g,"")},S=b,I=tinymce.util.Tools.resolve("tinymce.util.Delay"),K=tinymce.util.Tools.resolve("tinymce.util.XHR"),U={},D=function(e,t,n){var o=function(e,n){return n=n||[],y.each(e,function(e){var i={text:e.text||e.title};e.menu?i.menu=o(e.menu):(i.value=e.value,t&&t(i)),n.push(i)}),n};return o(e,n||[])},B=function(e,t,n){var o=e.selection.getRng();I.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),n(t)})})},F=function(e,t){var n,o,i,a,l,x,p,k,b,w,_,T={},C=e.selection,M=e.dom,N=function(e){var t=i.find("#text");(!t.value()||e.lastControl&&t.value()===e.lastControl.text())&&t.value(e.control.text()),i.find("#href").value(e.control.value())},A=function(){o||!a||T.text||this.parent().parent().find("#text")[0].value(this.value())};a=L(C.getContent()),n=P(e),T.text=o=E(e.selection,n),T.href=n?M.getAttrib(n,"href"):"",T.target=n?M.getAttrib(n,"target"):"_blank",(_=M.getAttrib(n,"rel"))&&(T.rel=_),(_=M.getAttrib(n,"class"))&&(T.class=_),(_=M.getAttrib(n,"title"))&&(T.title=_),a&&(l={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){T.text=this.value()}}),t&&(x={type:"listbox",label:"Link list",values:D(t,function(t){t.value=e.convertURL(t.value||t.url,"href")},[{text:"None",value:""}]),onselect:N,value:e.convertURL(T.href,"href"),onPostRender:function(){x=this}}),s(e.settings)&&(void 0===u(e.settings)&&c(e,[{text:"None",value:""},{text:"New window",value:"_blank"}]),k={name:"target",type:"listbox",label:"Target",values:D(u(e.settings))}),d(e.settings)&&(p={name:"rel",type:"listbox",label:"Rel",values:D(f(e.settings),function(t){!1===g(e.settings)&&(t.value=S(t.value,"_blank"===T.target))})}),m(e.settings)&&(b={name:"class",type:"listbox",label:"Class",values:D(v(e.settings),function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"a",classes:[t.value]})})})}),h(e.settings)&&(w={name:"title",type:"textbox",label:"Title",value:T.title}),i=e.windowManager.open({title:"Insert link",data:T,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(t){var n=t.meta||{};x&&x.value(e.convertURL(this.value(),"href")),y.each(t.meta,function(e,t){var n=i.find("#"+t);"text"===t?0===o.length&&(n.value(e),T.text=e):n.value(e)}),n.attach&&(U={href:this.value(),attach:n.attach}),n.text||A.call(this)},onkeyup:A,onpaste:A,onbeforecall:function(e){e.meta=i.toJSON()}},l,w,function(t){var n=[];if(y.each(e.dom.select("a:not([href])"),function(e){var o=e.name||e.id;o&&n.push({text:o,value:"#"+o,selected:-1!==t.indexOf("#"+o)})}),n.length)return n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:N}}(T.href),x,p,k,b],onSubmit:function(t){var n=r(e.settings),i=O(e,U),l=R(e),u=y.extend({},T,t.data),c=u.href;c?(a&&u.text!==o||delete u.text,c.indexOf("@")>0&&-1===c.indexOf("//")&&-1===c.indexOf("mailto:")?B(e,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(e){e&&(u.href="mailto:"+c),i(u)}):!0===n&&!/^\w+:/i.test(c)||!1===n&&/^\s*www[\.|\d\.]/i.test(c)?B(e,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(e){e&&(u.href="http://"+c),i(u)}):i(u)):l()}})},q=function(e){var t,n,o;n=F,"string"==typeof(o=l((t=e).settings))?K.send({url:o,success:function(e){n(t,JSON.parse(e))}}):"function"==typeof o?o(function(e){n(t,e)}):n(t,o)},V=function(e,t){return e.dom.getParent(t,"a[href]")},z=function(e){return V(e,e.selection.getStart())},H=function(e,t){if(t){var n=(i=t).getAttribute("data-mce-href")||i.getAttribute("href");if(/^#/.test(n)){var o=e.$(n);o.length&&e.selection.scrollIntoView(o[0],!0)}else k(t.href)}var i},J=function(e){return function(){q(e)}},$=function(e){return function(){H(e,z(e))}},j=function(e){return function(t){var n,o,i,r,l;return!!(a(e.settings)&&(r=e,l=r.plugins.contextmenu,!l||!l.isContextMenuVisible())&&N(t)&&3===(i=(o=(n=e.selection).getRng()).startContainer).nodeType&&n.isCollapsed()&&o.startOffset>0&&o.startOffset<i.data.length)}},G=function(e){e.on("click",function(n){var o=V(e,n.target);o&&t.metaKeyPressed(n)&&(n.preventDefault(),H(e,o))}),e.on("keydown",function(t){var n,o=z(e);o&&13===t.keyCode&&!0===(n=t).altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey&&(t.preventDefault(),H(e,o))})},X=function(e){return function(){var t=this;e.on("nodechange",function(n){t.active(!e.readonly&&!!P(e,n.element))})}},Q=function(e){return function(){var t=this,n=function(e){A(e.parents)?t.show():t.hide()};A(e.dom.getParents(e.selection.getStart()))||t.hide(),e.on("nodechange",n),t.on("remove",function(){e.off("nodechange",n)})}},W=function(e){e.addCommand("mceLink",J(e))},Y=function(e){e.addShortcut("Meta+K","",J(e))},Z=function(e){e.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:J(e),onpostrender:X(e)}),e.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:R(e),onpostrender:X(e)}),e.addContextToolbar&&e.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:$(e)})},ee=function(e){e.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:$(e),onPostRender:Q(e),prependToContext:!0}),e.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:J(e),stateSelector:"a[href]",context:"insert",prependToContext:!0}),e.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:R(e),stateSelector:"a[href]"})},te=function(e){e.addContextToolbar&&e.addContextToolbar(j(e),"openlink | link unlink")};e.add("link",function(e){Z(e),ee(e),te(e),G(e),W(e),Y(e)})}();